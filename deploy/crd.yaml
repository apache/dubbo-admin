# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: authenticationpolicies.dubbo.apache.org
spec:
  group: dubbo.apache.org
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                action:
                  type: string
                  description: "The action to take when a dds is matched."
                  enum:
                    - NONE
                    - DISABLED
                    - PERMISSIVE
                    - STRICT
                selector:
                  type: array
                  items:
                    type: object
                    description: "The source of the resource to be matched."
                    properties:
                      namespaces:
                        type: array
                        description: "The namespaces to match of the source workload."
                        items:
                          type: string
                      notNamespaces:
                        type: array
                        description: "The namespaces not to match of the source workload."
                        items:
                          type: string
                      ipBlocks:
                        type: array
                        description: "The IP addresses to match of the source workload."
                        items:
                          type: string
                      notIpBlocks:
                        type: array
                        description: "The IP addresses not to match of the source workload."
                        items:
                          type: string
                      principals:
                        type: array
                        description: "The identities(from spiffe) to match of the source workload."
                        items:
                          type: string
                      notPrincipals:
                        type: array
                        description: "The identities(from spiffe) not to match of the source workload."
                        items:
                          type: string
                      extends:
                        type: array
                        description: "The extended identities(from Dubbo Auth) to match of the source workload."
                        items:
                          type: object
                          properties:
                            key:
                              type: string
                              description: "The key of the extended identity."
                            value:
                              type: string
                              description: "The value of the extended identity."
                      notExtends:
                        type: array
                        description: "The extended identities(from Dubbo Auth) not to match of the source workload."
                        items:
                          type: object
                          properties:
                            key:
                              type: string
                              description: "The key of the extended identity."
                            value:
                              type: string
                              description: "The value of the extended identity."
                portLevel:
                  type: array
                  items:
                    type: object
                    properties:
                      port:
                        type: number
                        minimum: 0
                        default: 0
                        maximum: 65535
                      action:
                        type: string
                        description: "The action to take when a dds is matched."
                        enum:
                          - NONE
                          - DISABLED
                          - PERMISSIVE
                          - STRICT
                    required:
                      - action
                      - port
              required:
                - action
  scope: Namespaced
  names:
    plural: authenticationpolicies
    singular: authenticationpolicy
    kind: AuthenticationPolicy
    shortNames:
      - ac

---

apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: authorizationpolicies.dubbo.apache.org
spec:
  group: dubbo.apache.org
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                action:
                  type: string
                  description: "The action to take when a dds is matched."
                  enum:
                    - ALLOW
                    - DENY
                    - ADULT
                rules:
                  type: array
                  items:
                    type: object
                    properties:
                      from:
                        type: object
                        description: "The source of the resource to be matched."
                        properties:
                          namespaces:
                            type: array
                            description: "The namespaces to match of the source workload."
                            items:
                              type: string
                          notNamespaces:
                            type: array
                            description: "The namespaces not to match of the source workload."
                            items:
                              type: string
                          ipBlocks:
                            type: array
                            description: "The IP addresses to match of the source workload."
                            items:
                              type: string
                          notIpBlocks:
                            type: array
                            description: "The IP addresses not to match of the source workload."
                            items:
                              type: string
                          principals:
                            type: array
                            description: "The identities(from spiffe) to match of the source workload."
                            items:
                              type: string
                          notPrincipals:
                            type: array
                            description: "The identities(from spiffe) not to match of the source workload."
                            items:
                              type: string
                          extends:
                            type: array
                            description: "The extended identities(from Dubbo Auth) to match of the source workload."
                            items:
                              type: object
                              properties:
                                key:
                                  type: string
                                  description: "The key of the extended identity."
                                value:
                                  type: string
                                  description: "The value of the extended identity."
                          notExtends:
                            type: array
                            description: "The extended identities(from Dubbo Auth) not to match of the source workload."
                            items:
                              type: object
                              properties:
                                key:
                                  type: string
                                  description: "The key of the extended identity."
                                value:
                                  type: string
                                  description: "The value of the extended identity."
                      to:
                        type: object
                        description: "The destination of the resource to be matched."
                        properties:
                          namespaces:
                            type: array
                            description: "The namespaces to match of the source workload."
                            items:
                              type: string
                          notNamespaces:
                            type: array
                            description: "The namespaces not to match of the source workload."
                            items:
                              type: string
                          ipBlocks:
                            type: array
                            description: "The IP addresses to match of the destination workload."
                            items:
                              type: string
                          notIpBlocks:
                            type: array
                            description: "The IP addresses not to match of the destination workload."
                            items:
                              type: string
                          principals:
                            type: array
                            description: "The identities(from spiffe) to match of the destination workload."
                            items:
                              type: string
                          notPrincipals:
                            type: array
                            description: "The identities(from spiffe) not to match of the destination workload."
                            items:
                              type: string
                          extends:
                            type: array
                            description: "The extended identities(from Dubbo Auth) to match of the destination workload."
                            items:
                              type: object
                              properties:
                                key:
                                  type: string
                                  description: "The key of the extended identity."
                                value:
                                  type: string
                                  description: "The value of the extended identity."
                          notExtends:
                            type: array
                            description: "The extended identities(from Dubbo Auth) not to match of the destination workload."
                            items:
                              type: object
                              properties:
                                key:
                                  type: string
                                  description: "The key of the extended identity."
                                value:
                                  type: string
                                  description: "The value of the extended identity."
                      when:
                        type: object
                        properties:
                          key:
                            type: string
                          values:
                            type: array
                            items:
                              type: object
                              properties:
                                type:
                                  type: string
                                  enum:
                                    - equals
                                    - regex
                                    - ognl
                                  default: equals
                                value:
                                  type: string
                          notValues:
                            type: array
                            items:
                              type: object
                              properties:
                                type:
                                  type: string
                                  enum:
                                    - equals
                                    - regex
                                    - ognl
                                  default: equals
                                value:
                                  type: string
                samples:
                  type: number
                  description: "The sample rate of the dds. The value is between 0 and 100."
                  minimum: 0
                  default: 100
                  maximum: 100
                order:
                    type: number
                    description: "The order of the dds."
                    minimum: -2147483648
                    default: 0
                    maximum: 2147483647
                matchType:
                  type: string
                  description: "The match type of the rules."
                  enum:
                    - ANY_MATCH
                    - ALL_MATCH
                  default: ANY_MATCH
              required:
                - action
  scope: Namespaced
  names:
    plural: authorizationpolicies
    singular: authorizationpolicy
    kind: AuthorizationPolicy
    shortNames:
      - az

---

apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: servicenamemappings.dubbo.apache.org
spec:
  group: dubbo.apache.org
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          properties:
            spec:
              description:
                'Spec defines the behavior of a service mapping.
               https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status'
              properties:
                applicationNames:
                  items:
                    type: string
                  type: array
                interfaceName:
                  type: string
              type: object
          type: object
  scope: Namespaced
  names:
    plural: servicenamemappings
    singular: servicenamemapping
    kind: ServiceNameMapping
    shortNames:
      - snp

---

apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.11.3
  creationTimestamp: null
  name: conditionroutes.dubbo.apache.org
spec:
  group: dubbo.apache.org
  names:
    kind: ConditionRoute
    listKind: ConditionRouteList
    plural: conditionroutes
    shortNames:
      - cd
    singular: conditionroute
  scope: Namespaced
  versions:
    - name: v1alpha1
      schema:
        openAPIV3Schema:
          description: ConditionRoute is the Schema for the conditionroutes API
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the clientgen
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            spec:
              description: ConditionRouteSpec defines the desired state of ConditionRoute
              properties:
                conditions:
                  description: The condition routing dds definition of this configuration.
                    Check Condition for details
                  items:
                    type: string
                  type: array
                configVersion:
                  description: The version of the condition dds definition, currently
                    available version is v3.0
                  enum:
                    - v3.0
                  type: string
                enabled:
                  default: true
                  description: Whether enable this dds or not, set enabled:false to
                    disable this dds.
                  type: boolean
                force:
                  description: The behaviour when the instance subset is empty after
                    after routing. true means return no provider exception while false
                    means ignore this dds.
                  type: boolean
                key:
                  description: The identifier of the target service or application that
                    this dds is about to apply to. If scope:serviceis set, then keyshould
                    be specified as the Dubbo service key that this dds targets to
                    control. If scope:application is set, then keyshould be specified
                    as the name of the application that this dds targets to control,
                    application should always be a Dubbo Consumer.
                  type: string
                priority:
                  type: integer
                runtime:
                  description: Whether run routing dds for every rpc invocation or
                    use routing cache if available.
                  type: boolean
                scope:
                  description: Supports service and application scope rules.
                  enum:
                    - service
                    - application
                  type: string
              required:
                - conditions
                - configVersion
                - enabled
                - key
                - scope
              type: object
          type: object
      served: true
      storage: true
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.11.3
  creationTimestamp: null
  name: dynamicconfigs.dubbo.apache.org
spec:
  group: dubbo.apache.org
  names:
    kind: DynamicConfig
    listKind: DynamicConfigList
    plural: dynamicconfigs
    shortNames:
      - dc
    singular: dynamicconfig
  scope: Namespaced
  versions:
    - name: v1alpha1
      schema:
        openAPIV3Schema:
          description: DynamicConfig is the Schema for the dynamicconfigs API
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the clientgen
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            spec:
              description: DynamicConfigSpec defines the desired state of DynamicConfig
              properties:
                configVersion:
                  description: The version of the tag dds definition, currently available
                    version is v3.0
                  enum:
                    - v3.0
                  type: string
                configs:
                  description: The match condition and configuration of this dds.
                  items:
                    properties:
                      addresses:
                        description: replaced with address in MatchCondition
                        items:
                          type: string
                        type: array
                      applications:
                        description: replaced with application in MatchCondition
                        items:
                          type: string
                        type: array
                      enabled:
                        type: boolean
                      match:
                        description: A set of criterion to be met in order for the dds/config
                          to be applied to the Dubbo instance.
                        properties:
                          address:
                            description: 'The instance address matching condition for
                            this config dds to take effect. xact: “value” for exact
                            string match prefix: “value” for prefix-based match regex:
                            “value” for RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax)).'
                            properties:
                              cird:
                                type: string
                              exact:
                                type: string
                              wildcard:
                                type: string
                            type: object
                          application:
                            description: "The application matching condition for this
                            config dds to take effect. Effective when scope: service
                            is set. \n exact: “value” for exact string match prefix:
                            “value” for prefix-based match regex: “value” for RE2
                            style regex-based match (https://github.com/google/re2/wiki/Syntax))."
                            properties:
                              oneof:
                                items:
                                  properties:
                                    empty:
                                      type: string
                                    exact:
                                      type: string
                                    noempty:
                                      type: string
                                    prefix:
                                      type: string
                                    regex:
                                      type: string
                                    wildcard:
                                      type: string
                                  type: object
                                type: array
                            type: object
                          param:
                            description: The Dubbo url keys and values matching condition
                              for this config dds to take effect.
                            items:
                              properties:
                                key:
                                  description: The name of the key in the Dubbo url
                                    address.
                                  type: string
                                value:
                                  description: The matching condition for the value
                                    in the Dubbo url address.
                                  properties:
                                    empty:
                                      type: string
                                    exact:
                                      type: string
                                    noempty:
                                      type: string
                                    prefix:
                                      type: string
                                    regex:
                                      type: string
                                    wildcard:
                                      type: string
                                  type: object
                              type: object
                            type: array
                          service:
                            description: 'The service matching condition for this config
                            dds to take effect. Effective when scope: application
                            is set. exact: “value” for exact string match prefix:
                            “value” for prefix-based match regex: “value” for RE2
                            style regex-based match (https://github.com/google/re2/wiki/Syntax)).'
                            properties:
                              oneof:
                                items:
                                  properties:
                                    empty:
                                      type: string
                                    exact:
                                      type: string
                                    noempty:
                                      type: string
                                    prefix:
                                      type: string
                                    regex:
                                      type: string
                                    wildcard:
                                      type: string
                                  type: object
                                type: array
                            type: object
                        type: object
                      parameters:
                        additionalProperties:
                          type: string
                        type: object
                      providerAddresses:
                        description: not supported anymore
                        items:
                          type: string
                        type: array
                      services:
                        description: replaced with service in MatchCondition
                        items:
                          type: string
                        type: array
                      side:
                        description: 'Especially useful when scope:service is set. side:
                        providermeans this Config will only take effect on the provider
                        instances of the service key. side: consumermeans this Config
                        will only take effect on the consumer instances of the service
                        key'
                        type: string
                      type:
                        type: string
                    type: object
                  type: array
                enabled:
                  default: true
                  description: Whether enable this dds or not, set enabled:false to
                    disable this dds.
                  type: boolean
                key:
                  description: The identifier of the target service or application that
                    this dds is about to apply to. If scope:serviceis set, then keyshould
                    be specified as the Dubbo service key that this dds targets to
                    control. If scope:application is set, then keyshould be specified
                    as the name of the application that this dds targets to control,
                    application should always be a Dubbo Consumer.
                  type: string
                scope:
                  description: Supports service and application scope rules.
                  enum:
                    - service
                    - application
                  type: string
              type: object
          type: object
      served: true
      storage: true
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.11.3
  creationTimestamp: null
  name: tagroutes.dubbo.apache.org
spec:
  group: dubbo.apache.org
  names:
    kind: TagRoute
    listKind: TagRouteList
    plural: tagroutes
    shortNames:
      - tg
    singular: tagroute
  scope: Namespaced
  versions:
    - name: v1alpha1
      schema:
        openAPIV3Schema:
          description: TagRoute is the Schema for the tagroutes API
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the clientgen
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            spec:
              description: TagRouteSpec defines the desired state of TagRoute
              properties:
                configVersion:
                  description: The version of the tag dds definition, currently available
                    version is v3.0
                  enum:
                    - v3.0
                  type: string
                enabled:
                  default: true
                  description: Whether enable this dds or not, set enabled:false to
                    disable this dds.
                  type: boolean
                force:
                  default: true
                  description: The behaviour when the instance subset is empty after
                    after routing. true means return no provider exception while false
                    means ignore this dds.
                  type: boolean
                key:
                  description: The identifier of the target application that this dds
                    is about to control
                  type: string
                priority:
                  maximum: 2147483647
                  minimum: -2147483648
                  type: integer
                runtime:
                  default: true
                  description: Whether run routing dds for every rpc invocation or
                    use routing cache if available.
                  type: boolean
                tags:
                  description: The tag definition of this dds.
                  items:
                    properties:
                      addresses:
                        items:
                          type: string
                        type: array
                      match:
                        description: A set of criterion to be met for instances to be
                          classified as member of this tag.
                        items:
                          properties:
                            key:
                              description: The name of the key in the Dubbo url address.
                              type: string
                            value:
                              description: The matching condition for the value in the
                                Dubbo url address.
                              properties:
                                empty:
                                  type: string
                                exact:
                                  type: string
                                noempty:
                                  type: string
                                prefix:
                                  type: string
                                regex:
                                  type: string
                                wildcard:
                                  type: string
                              type: object
                          type: object
                        type: array
                      name:
                        description: The name of the tag used to match the dubbo.tag
                          value in the request context.
                        type: string
                    type: object
                  type: array
              type: object
          type: object
      served: true
      storage: true
